# kempower.yml
# EVBot Fault Pack: Kempower (Top 12 by impact / frequency style)
# Source: Kempower Error Codes Rev 2.00 (09-2025)

faults:

  - id: kempower_power_module_fault
    platform: kempower
    charger_type: dc
    title: "Power Module / Power Stack Fault (PMC / DPDM)"
    severity: high
    tags: [power, module, pmc, dpdm, rectifier, derate]

    description: >
      One or more power modules or power stack controllers are offline or faulted.
      This commonly results in derating or the charger becoming unavailable.

    safety_notes:
      - Follow site LOTO and Kempower safety procedures before cabinet access
      - Do not reseat or move modules unless authorised/trained
      - Do not re-energise if signs of damage or overheating are present

    decision_tree:
      start_node: KPM0
      nodes:

        KPM0:
          prompt: |
            *Power Module / Power Stack Fault â€” Start*
            Is the charger derated (reduced output) or fully unavailable?
          options:
            - label: "Derated (reduced kW)"
              next: KPM1
            - label: "Unavailable / wonâ€™t start"
              next: KPM1

        KPM1:
          prompt: |
            *Initial visual & electrical checks*
            Perform safe external checks:
            â€¢ Any breakers or fuses tripped?
            â€¢ Any visible alarms on cabinets?
            â€¢ Any obvious burning smell, discoloration, or damage?
          options:
            - label: "Breaker/fuse issue found"
              next: KPM_FIX_BREAKER
            - label: "Visible damage or burning"
              next: KPM_ESC_DANGER
            - label: "No obvious issues"
              next: KPM2

        KPM_FIX_BREAKER:
          prompt: |
            *Breaker / supply recovery*
            Reset tripped breakers/fuses once only (if permitted).
            Monitor closely during restart.
          options:
            - label: "Recovered"
              next: KPM_DONE
            - label: "Trips again / still faulting"
              next: KPM_ESC

        KPM2:
          prompt: |
            *Power cycle recovery*
            Perform a controlled power cycle of the station per site procedure.
            Allow full shutdown and restart.
          options:
            - label: "Recovered after power cycle"
              next: KPM_DONE
            - label: "Still faulting"
              next: KPM3

        KPM3:
          prompt: |
            *Module / slot identification*
            Can you identify a specific cabinet, slot, or module reporting a fault?
          options:
            - label: "Yes â€” specific module/slot"
              next: KPM4
            - label: "No â€” unclear"
              next: KPM5

        KPM4:
          prompt: |
            *Module reseat / slot isolation (if authorised)*
            If permitted:
            â€¢ Apply LOTO
            â€¢ Reseat the affected module
            â€¢ Inspect connectors for burning, bent pins, contamination
          options:
            - label: "Damage found"
              next: KPM_ESC_DANGER
            - label: "Reseated â€” re-test"
              next: KPM_RETEST
            - label: "Not permitted"
              next: KPM5

        KPM5:
          prompt: |
            *Firmware & configuration check*
            Check:
            â€¢ Station firmware version
            â€¢ Recent updates or rollbacks
            â€¢ DPDM/PMC detected correctly in configuration
          options:
            - label: "Firmware/config issue found"
              next: KPM_ESC
            - label: "No issues found"
              next: KPM_ESC

        KPM_RETEST:
          prompt: |
            *Re-test*
            Re-energise and run a short charging session.
            Monitor output stability and fault recurrence.
          options:
            - label: "Resolved"
              next: KPM_DONE
            - label: "Still faulting"
              next: KPM_ESC

        KPM_ESC_DANGER:
          prompt: |
            *âš ï¸ Escalate immediately â€” unsafe condition*
            Do NOT re-energise.
            Evidence required:
            â€¢ Photos of damage/burn marks
            â€¢ Affected cabinet/module
            â€¢ Error codes and timestamps
          options:
            - label: "ðŸ  Kempower menu"
              next: __MENU_KEMPOWER__

        KPM_ESC:
          prompt: |
            *Escalate â€” Power Module / Stack Fault*
            Include:
            â€¢ Exact error codes/messages
            â€¢ Affected cabinet/module/slot
            â€¢ Derate level (kW)
            â€¢ Actions already attempted
            â€¢ Firmware version
            â€¢ Photos/screenshots
          options:
            - label: "ðŸ  Kempower menu"
              next: __MENU_KEMPOWER__

        KPM_DONE:
          prompt: |
            *Complete*
            âœ… Power module troubleshooting complete.
          options:
            - label: "ðŸ  Kempower menu"
              next: __MENU_KEMPOWER__


  - id: kempower_no_heartbeat
    platform: kempower
    charger_type: dc
    title: "Satellite / Control Unit Offline (No Communication)"

    aliases: ["no heartbeat", "satellite offline", "control unit offline"]
    triggers:
      any_text_contains: ["NO_HEARTBEAT", "no heartbeat"]
    severity: high
    tags: [network, ethernet, satellite, control_unit, offline]

    description: >
      Satellite/Control Unit is configured but not available on the local network. :contentReference[oaicite:0]{index=0}

    decision_tree:
      start_node: KHB0
      nodes:
        KHB0:
          prompt: |
            *NO_HEARTBEAT â€” Start*
            Is it *one* Satellite/Control Unit, or *all* of them?
          options:
            - label: "Only one satellite"
              next: KHB1
            - label: "All satellites"
              next: KHB2

        KHB1:
          prompt: |
            *Single satellite issue*
            Check 24V supply at the Satellite/Control Unit (23â€“25VDC) and inspect RJ45 cabling/termination.
            If needed, inspect RJ45 extension block connections and flat cable to the display.
          options:
            - label: "Power/ethernet fixed â†’ retest"
              next: KHB3
            - label: "Still offline"
              next: KHB_ESC
          # From Kempower steps: measure 23â€“25VDC, check RJ45 cabling + extension block :contentReference[oaicite:1]{index=1}

        KHB2:
          prompt: |
            *System-wide issue*
            Check network links between main/secondary cabinets and inside control module (omega board â†” Ethernet switch).
            With multi-cabinet units, confirm cabinet GND terminal blocks are jumpered.
          options:
            - label: "Fixed â†’ retest"
              next: KHB3
            - label: "Still offline"
              next: KHB_ESC
          # From Kempower steps: multi-cabinet checks, GND jumper, mainâ†”secondary links :contentReference[oaicite:2]{index=2}

        KHB3:
          prompt: |
            *Re-test*
            Restart charger and confirm heartbeat returns.
          options:
            - label: "Done"
              next: __MENU_KEMPOWER__

        KHB_ESC:
          prompt: |
            *Escalate*
            Provide: which satellite(s), 24V measurement result, cabling checks performed, and timestamps.
          options:
            - label: "Kempower menu"
              next: __MENU_KEMPOWER__


  - id: kempower_comm_not_ready
    platform: kempower
    charger_type: dc
    title: "Vehicle Communication Failed (CCS Control Pilot Not Ready)"

    aliases: ["comm not ready", "ccs not ready", "control pilot fault"]
    triggers:
      any_text_contains: ["COMM_NOT_READY", "comm_not_ready"]
    severity: high
    tags: [ccs, control_pilot, connector, startup]

    description: >
      CCS not available; Control Pilot (CP) in fault state during startup. :contentReference[oaicite:3]{index=3}

    decision_tree:
      start_node: KCP0
      nodes:
        KCP0:
          prompt: |
            *COMM_NOT_READY â€” Start*
            Is this after recent install/commissioning work or hardware changes?
          options:
            - label: "Yes (recent changes)"
              next: KCP1
            - label: "No (sudden fault)"
              next: KCP2

        KCP1:
          prompt: |
            *Commissioning / wiring path*
            Restart the charger and verify CP pin is connected correctly.
            If hardware mismatch is suspected, replace optional CCS card with newer revision.
          options:
            - label: "Resolved"
              next: KCP_DONE
            - label: "Still failing"
              next: KCP_ESC
          # From doc: restart, connect CP pin correctly, replace CCS card revision :contentReference[oaicite:4]{index=4}

        KCP2:
          prompt: |
            *Sudden fault path*
            Restart the charger. If persists, treat as CCS card / CP wiring integrity issue and escalate with photos/notes.
          options:
            - label: "Resolved"
              next: KCP_DONE
            - label: "Still failing"
              next: KCP_ESC

        KCP_DONE:
          prompt: |
            *Complete*
            âœ… CCS/CP flow complete.
          options:
            - label: "Kempower menu"
              next: __MENU_KEMPOWER__

        KCP_ESC:
          prompt: |
            *Escalate*
            Provide: connector ID, CP wiring check result, any recent work, and timestamps.
          options:
            - label: "Kempower menu"
              next: __MENU_KEMPOWER__


  - id: kempower_rcm_bad
    platform: kempower
    charger_type: ac
    title: "Earth Leakage Detected (Residual Current Monitor Trip)"

    aliases: ["rcm bad", "residual current leak", "earth leakage"]
    triggers:
      any_text_contains: ["RCM_BAD", "rcm_bad"]
    severity: high
    tags: [safety, rcd, rcm, earth_leakage, type2]

    description: >
      Residual current monitor detected a leak to protective earth (PE); connector disabled for safety. :contentReference[oaicite:5]{index=5}

    decision_tree:
      start_node: KRCM0
      nodes:
        KRCM0:
          prompt: |
            *RCM_BAD â€” Start*
            Did it occur once only, possibly after rain/moisture?
          options:
            - label: "Yes (single event)"
              next: KRCM1
            - label: "Repeating"
              next: KRCM2

        KRCM1:
          prompt: |
            *Single event*
            Restart charger. If needed, shut off AC main power supply and turn back ON, then re-test.
          options:
            - label: "Resolved"
              next: KRCM_DONE
            - label: "Still present"
              next: KRCM2

        KRCM2:
          prompt: |
            *Repeating / persistent*
            Find source of leakage:
            - Measure insulation resistance between all phases and PE (follow local safety rules).
            If insulation is OK, replace the RCM.
          options:
            - label: "Escalate (need support)"
              next: KRCM_ESC
            - label: "Done"
              next: KRCM_DONE
          # From doc: insulation resistance check, replace RCM if measurements OK :contentReference[oaicite:6]{index=6}

        KRCM_DONE:
          prompt: |
            *Complete*
            âœ… RCM flow complete.
          options:
            - label: "Kempower menu"
              next: __MENU_KEMPOWER__

        KRCM_ESC:
          prompt: |
            *Escalate*
            Provide: weather/moisture notes, IR results, photos of connector/port, timestamps.
          options:
            - label: "Kempower menu"
              next: __MENU_KEMPOWER__


  - id: kempower_afe_communication_error
    platform: kempower
    charger_type: dc
    title: "Grid Input Stage Communication Fault (AFE Internal Comms)"
    aliases: ["afe communication error", "pmc comms bus error"]
    triggers:
      any_text_contains: ["AFE_COMMUNICATION_ERROR", "afe_communication_error"]
    severity: medium
    tags: [pmc, afe, firmware, comms]

    description: >
      PMC internal communication bus error; PMC temporarily unavailable; reduced power in cabinet. :contentReference[oaicite:7]{index=7}

    decision_tree:
      start_node: KAFE0
      nodes:
        KAFE0:
          prompt: |
            *AFE_COMMUNICATION_ERROR â€” Start*
            Is this a one-off or frequent/repeating?
          options:
            - label: "One-off"
              next: KAFE1
            - label: "Repeating"
              next: KAFE2

        KAFE1:
          prompt: |
            *One-off*
            If it appears once, no action is typically necessary. Monitor.
          options:
            - label: "Back to menu"
              next: __MENU_KEMPOWER__

        KAFE2:
          prompt: |
            *Repeating*
            Update firmware/software to latest release and escalate if it continues.
          options:
            - label: "Escalate"
              next: KAFE_ESC
            - label: "Back"
              next: __MENU_KEMPOWER__

        KAFE_ESC:
          prompt: |
            *Escalate*
            Provide: frequency, cabinet/module affected, firmware version, timestamps.
          options:
            - label: "Kempower menu"
              next: __MENU_KEMPOWER__


  - id: kempower_fan_current
    platform: kempower
    charger_type: dc
    title: "Cooling Fan Electrical Fault (Fan Current Out of Range)"
    aliases: ["fan current", "fan fault", "thermal performance reduced"]
    triggers:
      any_text_contains: ["FAN_CURRENT", "fan_current"]
    severity: medium
    tags: [fan, cooling, airflow, firmware, pmc]

    description: >
      Fan current out of range; output reduced and thermal performance reduced. :contentReference[oaicite:8]{index=8}

    decision_tree:
      start_node: KFN0
      nodes:
        KFN0:
          prompt: |
            *FAN_CURRENT â€” Start*
            Is airflow obstructed / filters dirty / fan noise present?
          options:
            - label: "Yes"
              next: KFN1
            - label: "No / unsure"
              next: KFN2

        KFN1:
          prompt: |
            *Airflow path*
            Clear obstructions, check filters, confirm fans spin freely and are not noisy.
            If needed, replace fans.
          options:
            - label: "Resolved"
              next: KFN_DONE
            - label: "Still failing"
              next: KFN_ESC

        KFN2:
          prompt: |
            *Standard recovery*
            Remote restart â†’ local restart â†’ remote fault analysis. Update software to latest.
            If persists, schedule site visit / replace fans.
          options:
            - label: "Escalate"
              next: KFN_ESC
            - label: "Done"
              next: KFN_DONE

        KFN_DONE:
          prompt: |
            *Complete*
            âœ… Fan flow complete.
          options:
            - label: "Kempower menu"
              next: __MENU_KEMPOWER__

        KFN_ESC:
          prompt: |
            *Escalate*
            Provide: cabinet/module, fan noise/airflow notes, software version, timestamps.
          options:
            - label: "Kempower menu"
              next: __MENU_KEMPOWER__


  - id: kempower_primary_undervoltage
    platform: kempower
    charger_type: dc
    title: "Incoming Supply Too Low (Undervoltage / Phase Issue)"
    aliases: ["primary undervoltage", "supply too low"]
    triggers:
      any_text_contains: ["PRIMARY_UNDERVOLTAGE", "primary_undervoltage"]
    severity: high
    tags: [grid, supply, undervoltage, wiring, pmc]

    description: >
      Primary circuit voltage too low; reduced power available; can relate to supply insufficiency or wiring/module issues. :contentReference[oaicite:9]{index=9}

    decision_tree:
      start_node: KUV0
      nodes:
        KUV0:
          prompt: |
            *PRIMARY_UNDERVOLTAGE â€” Start*
            Is site/grid voltage actually low (measure under load if possible)?
          options:
            - label: "Yes (grid low)"
              next: KUV1
            - label: "No / unknown"
              next: KUV2

        KUV1:
          prompt: |
            *Grid-side issue*
            Confirm supply is sufficient for the unit; escalate to electricity distributor if needed.
          options:
            - label: "Back to menu"
              next: __MENU_KEMPOWER__

        KUV2:
          prompt: |
            *Charger-side checks*
            Check PMC breaker ON, inspect rear connector pins (not bent/broken), move module to another slot and see if fault follows.
            If fault follows module â†’ replace module.
          options:
            - label: "Resolved"
              next: KUV_DONE
            - label: "Still failing"
              next: KUV_ESC
          # From doc: breaker, connector pins, swap slot, replace if follows :contentReference[oaicite:10]{index=10}

        KUV_DONE:
          prompt: |
            *Complete*
            âœ… Undervoltage flow complete.
          options:
            - label: "Kempower menu"
              next: __MENU_KEMPOWER__

        KUV_ESC:
          prompt: |
            *Escalate*
            Provide: measured L-L voltages under load, which PMC slot, connector inspection result.
          options:
            - label: "Kempower menu"
              next: __MENU_KEMPOWER__


  - id: kempower_rt_pmc_unavailable
    platform: kempower
    charger_type: dc
    title: "Power Module Controller Offline (PMC Not Communicating)"
    aliases: ["rt pmc unavailable", "pmc not communicating"]
    triggers:
      any_text_contains: ["RT_PMC_UNAVAILABLE", "rt_pmc_unavailable"]
    severity: high
    tags: [pmc, canbus, 24v, fuse, config, comms]

    description: >
      Power Module is in configuration but not communicating; output reduced by 25kW. :contentReference[oaicite:11]{index=11}

    decision_tree:
      start_node: KPU0
      nodes:
        KPU0:
          prompt: |
            *Power Module Controller Offline*
            After restart, is the PMC still missing/unavailable?
          options:
            - label: "Yes"
              next: KPU1
            - label: "No"
              next: KPU_DONE

        KPU1:
          prompt: |
            *Local checks*
            Confirm module install matches configuration, check status LEDs for 24V supply, reset AUX fuse if tripped.
            Inspect connector pins for damage; check airflow/filters.
          options:
            - label: "Resolved"
              next: KPU_DONE
            - label: "Still failing"
              next: KPU2

        KPU2:
          prompt: |
            *Hardware path*
            Update software to latest; consider bus divider in control module; replace PMC if required.
          options:
            - label: "Escalate"
              next: KPU_ESC
            - label: "Back"
              next: __MENU_KEMPOWER__

        KPU_DONE:
          prompt: |
            *Complete*
            âœ… PMC unavailable flow complete.
          options:
            - label: "Kempower menu"
              next: __MENU_KEMPOWER__

        KPU_ESC:
          prompt: |
            *Escalate*
            Provide: PMC slot, 24V/LED status, AUX fuse status, photos of rear connector pins, timestamps.
          options:
            - label: "Kempower menu"
              next: __MENU_KEMPOWER__


  - id: kempower_rt_relaycard_missing
    platform: kempower
    charger_type: dc
    title: "Power Distribution Module Missing (DPDM Not Detected)"
    aliases: ["rt relaycard missing", "dpdm missing"]
    triggers:
      any_text_contains: ["RT_RELAYCARD_MISSING", "rt_relaycard_missing"]
    severity: high
    tags: [dpdm, dynamic, ethernet, cabinet, comms]

    description: >
      Unit configured as dynamic but no DPDM found; comms loss between cabinets; damaged pins/connectors or defective DPDM. :contentReference[oaicite:12]{index=12}

    decision_tree:
      start_node: KDP0
      nodes:
        KDP0:
          prompt: |
            *RT_RELAYCARD_MISSING â€” Start*
            Is this a multi-cabinet / dynamic system with secondary cabinets present?
          options:
            - label: "Yes"
              next: KDP1
            - label: "Not sure"
              next: KDP1

        KDP1:
          prompt: |
            *Comms & connectors*
            Check Ethernet wiring between cabinets and try a different port on cabinet switch.
            Inspect DPDM connector pins + cabinet connectors (no bent/broken pins).
          options:
            - label: "Resolved"
              next: KDP_DONE
            - label: "Still failing"
              next: KDP2

        KDP2:
          prompt: |
            *DPDM isolate / swap*
            If secondary cabinets exist, you may run reduced capacity by removing PMCs from affected cabinet in config.
            If possible, interchange DPDMs between cabinets and see if fault follows. Replace DPDM if needed.
          options:
            - label: "Escalate"
              next: KDP_ESC
            - label: "Done"
              next: KDP_DONE

        KDP_DONE:
          prompt: |
            *Complete*
            âœ… DPDM missing flow complete.
          options:
            - label: "Kempower menu"
              next: __MENU_KEMPOWER__

        KDP_ESC:
          prompt: |
            *Escalate*
            Provide: cabinet topology, Ethernet checks, DPDM swap result, photos of connectors/pins, timestamps.
          options:
            - label: "Kempower menu"
              next: __MENU_KEMPOWER__


  - id: kempower_rt_safety_error_in_this_pmc
    platform: kempower
    charger_type: dc
    title: "Electrical Safety Fault Detected (Isolation / Moisture Risk)"
    aliases: ["rt safety error", "isolation fault", "pmc safety error"]
    triggers:
      any_text_contains: ["RT_SAFETY_ERROR_IN_THIS_PMC", "rt_safety_error_in_this_pmc"]
    severity: critical
    tags: [safety, insulation, isolation, water_ingress, dpdm, maintenance]

    description: >
      Indication of isolation issue; charging cannot continue safely; may trigger self-check; often related to moisture/water ingress and maintenance. :contentReference[oaicite:13]{index=13}

    decision_tree:
      start_node: KISO0
      nodes:
        KISO0:
          prompt: |
            *RT_SAFETY_ERROR_IN_THIS_PMC â€” Start*
            Treat as *safety critical*.
            Is there any evidence of water ingress / moisture marks?
          options:
            - label: "Yes"
              next: KISO1
            - label: "No / unsure"
              next: KISO2

        KISO1:
          prompt: |
            *Moisture path*
            Inspect cabinet for water ingress and module front panels for moisture marks/buildup.
            Review maintenance history (filters/PM intervals) and adjust frequency if needed.
          options:
            - label: "Escalate"
              next: KISO_ESC

        KISO2:
          prompt: |
            *Still treat seriously*
            Perform the same inspection steps and escalate with evidenceâ€”do not keep running repeated sessions.
          options:
            - label: "Escalate"
              next: KISO_ESC

        KISO_ESC:
          prompt: |
            *Escalate*
            Provide: which PMC, photos of cabinet/modules, maintenance history notes, timestamps, any environmental factors.
          options:
            - label: "Kempower menu"
              next: __MENU_KEMPOWER__


  - id: kempower_ssc_pmc_communication_error
    platform: kempower
    charger_type: dc
    title: "Power Module Self-Check Failed (PMC Communication Error)"
    aliases: ["ssc pmc communication error", "drive command failed"]
    triggers:
      any_text_contains: ["SSC_PMC_COMMUNICATION_ERROR", "ssc_pmc_communication_error"]
    severity: high
    tags: [self_check, pmc, comms, install]

    description: >
      Failed to send drive command to PMC during self-check; output reduced by 25kW. :contentReference[oaicite:14]{index=14}

    decision_tree:
      start_node: KSC0
      nodes:
        KSC0:
          prompt: |
            *SSC_PMC_COMMUNICATION_ERROR â€” Start*
            Is SSC_PMC_FAN_CONTROL also present?
          options:
            - label: "Yes"
              next: KSC1
            - label: "No"
              next: KSC2

        KSC1:
          prompt: |
            *Prioritise fan control first*
            Troubleshoot SSC_PMC_FAN_CONTROL first, then re-test this error.
          options:
            - label: "Back"
              next: __MENU_KEMPOWER__

        KSC2:
          prompt: |
            *Connection / seating*
            Ensure PMC is correctly installed/seated. Restart and re-test.
            If persists, replace affected Power Module.
          options:
            - label: "Resolved"
              next: KSC_DONE
            - label: "Escalate"
              next: KSC_ESC

        KSC_DONE:
          prompt: |
            *Complete*
            âœ… Self-check comms flow complete.
          options:
            - label: "Kempower menu"
              next: __MENU_KEMPOWER__

        KSC_ESC:
          prompt: |
            *Escalate*
            Provide: module slot, seating check performed, any companion SSC codes, timestamps.
          options:
            - label: "Kempower menu"
              next: __MENU_KEMPOWER__


  - id: kempower_ssc_pmc_enable_line_error
    platform: kempower
    charger_type: dc
    title: "Power Module Control Signal Fault â€“ Enable Line or Control Signal Missing"
    aliases: ["ssc pmc enable line error", "enable line fault"]
    triggers:
      any_text_contains: ["SSC_PMC_ENABLE_LINE_ERROR", "ssc_pmc_enable_line_error"]
    severity: high
    tags: [self_check, dpdm, enable_line, ct_lines, wiring]

    description: >
      PMC could not validate enable line during self-check; measure continuity EN line, check CT lines and connector pins; may require DPDM/PMC replacement. :contentReference[oaicite:15]{index=15}

    decision_tree:
      start_node: KEN0
      nodes:
        KEN0:
          prompt: |
            *SSC_PMC_ENABLE_LINE_ERROR â€” Start*
            Has any cabling/config work been done recently (CT lines, DPDM, PMCs)?
          options:
            - label: "Yes"
              next: KEN1
            - label: "No / unsure"
              next: KEN2

        KEN1:
          prompt: |
            *Cabling crosscheck*
            Do a cabling crosscheck; verify station config; confirm CT lines are correct.
            Inspect module/DPDM seating and connector pins.
          options:
            - label: "Continue"
              next: KEN2

        KEN2:
          prompt: |
            *Electrical checks*
            Measure continuity on enable line (EN) between PMC and DPDM.
            If a defective PMC appears, move to another slot and see if fault follows.
            If secondary cabinets exist, swap DPDMs to see if fault follows.
          options:
            - label: "Resolved"
              next: KEN_DONE
            - label: "Escalate / replace DPDM/PMC"
              next: KEN_ESC

        KEN_DONE:
          prompt: |
            *Complete*
            âœ… Enable line flow complete.
          options:
            - label: "Kempower menu"
              next: __MENU_KEMPOWER__

        KEN_ESC:
          prompt: |
            *Escalate*
            Provide: continuity test result, CT wiring notes, photos of connector pins, what followed swap, timestamps.
          options:
            - label: "Kempower menu"
              next: __MENU_KEMPOWER__


  - id: kempower_ssc_pmc_voltage_missing
    platform: kempower
    charger_type: dc
    title: "Power Module Not Producing Output â€“ No DC Voltage Detected"
    aliases: ["ssc pmc voltage missing", "pmc no voltage self-check"]
    triggers:
      any_text_contains: ["SSC_PMC_VOLTAGE_MISSING", "ssc_pmc_voltage_missing"]
    severity: high
    tags: [self_check, pmc, breaker, fuse, mains]

    description: >
      PMC cannot output voltage during self-check (V1/V2 variants); check breaker/fuse, missing phase, and swap module to confirm if fault follows. :contentReference[oaicite:16]{index=16} :contentReference[oaicite:17]{index=17}

    decision_tree:
      start_node: KVM0
      nodes:
        KVM0:
          prompt: |
            *SSC_PMC_VOLTAGE_MISSING â€” Start*
            Is the Power Module breaker tripped / fuse suspected / missing phase suspected?
          options:
            - label: "Yes"
              next: KVM1
            - label: "No / unsure"
              next: KVM2

        KVM1:
          prompt: |
            *Supply & breaker path*
            Confirm mains present / phases OK.
            Check PMC breaker state (do not switch ON with cabinet power ON).
            Restart and re-test.
          options:
            - label: "Continue"
              next: KVM2

        KVM2:
          prompt: |
            *Swap test*
            Interchange the affected module with a known-good in the same cabinet and see if fault follows.
            If it follows the module â†’ replace it.
          options:
            - label: "Resolved"
              next: KVM_DONE
            - label: "Escalate"
              next: KVM_ESC

        KVM_DONE:
          prompt: |
            *Complete*
            âœ… Voltage missing flow complete.
          options:
            - label: "Kempower menu"
              next: __MENU_KEMPOWER__

        KVM_ESC:
          prompt: |
            *Escalate*
            Provide: breaker state, phase measurements, swap result, any companion AFE/SSC codes, timestamps.
          options:
            - label: "Kempower menu"
              next: __MENU_KEMPOWER__


  - id: kempower_ssc_selftest_internal_error
    platform: kempower
    charger_type: dc
    title: "Internal System Fault â€“ Self-Test Failed"
    aliases: ["ssc selftest internal error", "self check failed", "all connectors failed"]
    triggers:
      any_text_contains: ["SSC_SELFTEST_INTERNAL_ERROR", "ssc_selftest_internal_error"]
    severity: critical
    tags: [self_check, configuration, canbus, software, dpdm]

    description: >
      System self-check failed; may be due to outdated software vs hardware, CAN wiring/divider board issues; troubleshoot companion SSC errors first. :contentReference[oaicite:18]{index=18}

    decision_tree:
      start_node: KST0
      nodes:
        KST0:
          prompt: |
            *SSC_SELFTEST_INTERNAL_ERROR â€” Start*
            Are other SSC codes present (e.g., SSC_CONNECTOR_VOLTAGE_MISSING)?
          options:
            - label: "Yes"
              next: KST1
            - label: "No"
              next: KST2

        KST1:
          prompt: |
            *Do the other SSC codes first*
            Troubleshoot companion SSC codes first, then re-run self-check.
          options:
            - label: "Back"
              next: __MENU_KEMPOWER__

        KST2:
          prompt: |
            *Core system checks*
            Perform inventory scan to confirm PMCs found.
            Verify DPDM configured correctly (if dynamic).
            Update software to latest available version.
            Inspect CAN bus divider board installation/wiring/damage.
          options:
            - label: "Escalate"
              next: KST_ESC
            - label: "Back"
              next: __MENU_KEMPOWER__

        KST_ESC:
          prompt: |
            *Escalate*
            Provide: inventory scan results, software version, CAN divider inspection notes, other SSC codes, timestamps.
          options:
            - label: "Kempower menu"
              next: __MENU_KEMPOWER__
